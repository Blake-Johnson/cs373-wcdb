/*
Copyright (c) 2011 Sencha Inc. - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
!function(){window.$jit=function(e){e=e||window;for(var t in $jit)$jit[t].$extend&&(e[t]=$jit[t])},$jit.version="2.0.1";var e=function(e){return document.getElementById(e)};e.empty=function(){},e.extend=function(e,t){for(var n in t||{})e[n]=t[n];return e},e.lambda=function(e){return"function"==typeof e?e:function(){return e}},e.time=Date.now||function(){return+new Date},e.splat=function(t){var n=e.type(t);return n?"array"!=n?[t]:t:[]},e.type=function(t){var n=e.type.s.call(t).match(/^\[object\s(.*)\]$/)[1].toLowerCase();return"object"!=n?n:t&&t.$$family?t.$$family:t&&t.nodeName&&1==t.nodeType?"element":n},e.type.s=Object.prototype.toString,e.each=function(t,n){var i=e.type(t);if("object"==i)for(var s in t)n(t[s],s);else for(var o=0,a=t.length;a>o;o++)n(t[o],o)},e.indexOf=function(e,t){if(Array.indexOf)return e.indexOf(t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},e.map=function(t,n){var i=[];return e.each(t,function(e,t){i.push(n(e,t))}),i},e.reduce=function(e,t,n){var i=e.length;if(0==i)return n;for(var s=3==arguments.length?n:e[--i];i--;)s=t(s,e[i]);return s},e.merge=function(){for(var t={},n=0,i=arguments.length;i>n;n++){var s=arguments[n];if("object"==e.type(s))for(var o in s){var a=s[o],r=t[o];t[o]=r&&"object"==e.type(a)&&"object"==e.type(r)?e.merge(r,a):e.unlink(a)}}return t},e.unlink=function(t){var n;switch(e.type(t)){case"object":n={};for(var i in t)n[i]=e.unlink(t[i]);break;case"array":n=[];for(var s=0,o=t.length;o>s;s++)n[s]=e.unlink(t[s]);break;default:return t}return n},e.zip=function(){if(0===arguments.length)return[];for(var e=0,t=[],n=arguments.length,i=arguments[0].length;i>e;e++){for(var s=0,o=[];n>s;s++)o.push(arguments[s][e]);t.push(o)}return t},e.rgbToHex=function(e,t){if(e.length<3)return null;if(4==e.length&&0==e[3]&&!t)return"transparent";for(var n=[],i=0;3>i;i++){var s=(e[i]-0).toString(16);n.push(1==s.length?"0"+s:s)}return t?n:"#"+n.join("")},e.hexToRgb=function(e){if(7!=e.length){if(e=e.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/),e.shift(),3!=e.length)return null;for(var t=[],n=0;3>n;n++){var i=e[n];1==i.length&&(i+=i),t.push(parseInt(i,16))}return t}return e=parseInt(e.slice(1),16),[e>>16,255&e>>8,255&e]},e.destroy=function(t){e.clean(t),t.parentNode&&t.parentNode.removeChild(t),t.clearAttributes&&t.clearAttributes()},e.clean=function(t){for(var n=t.childNodes,i=0,s=n.length;s>i;i++)e.destroy(n[i])},e.addEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},e.addEvents=function(t,n){for(var i in n)e.addEvent(t,i,n[i])},e.hasClass=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1},e.addClass=function(t,n){e.hasClass(t,n)||(t.className=t.className+" "+n)},e.removeClass=function(e,t){e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)"),"$1")},e.getPos=function(e){function t(e){for(var t={x:0,y:0};e&&!i(e);)t.x+=e.offsetLeft,t.y+=e.offsetTop,e=e.offsetParent;return t}function n(e){for(var t={x:0,y:0};e&&!i(e);)t.x+=e.scrollLeft,t.y+=e.scrollTop,e=e.parentNode;return t}function i(e){return/^(?:body|html)$/i.test(e.tagName)}var s=t(e),o=n(e);return{x:s.x-o.x,y:s.y-o.y}},e.event={get:function(e,t){return t=t||window,e||t.event},getWheel:function(e){return e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3},isRightClick:function(e){return 3==e.which||2==e.button},getPos:function(e,t){t=t||window,e=e||t.event;var n=t.document;n=n.documentElement||n.body,e.touches&&e.touches.length&&(e=e.touches[0]);var i={x:e.pageX||e.clientX+n.scrollLeft,y:e.pageY||e.clientY+n.scrollTop};return i},stop:function(e){e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1}},$jit.util=$jit.id=e;var t=function(n){n=n||{};var i=function(){for(var n in this)"function"!=typeof this[n]&&(this[n]=e.unlink(this[n]));if(this.constructor=i,t.prototyping)return this;var s=this.initialize?this.initialize.apply(this,arguments):this;return this.$$family="class",s};for(var s in t.Mutators)n[s]&&(n=t.Mutators[s](n,n[s]),delete n[s]);return e.extend(i,this),i.constructor=t,i.prototype=n,i};t.Mutators={Implements:function(n,i){return e.each(e.splat(i),function(e){t.prototyping=e;var i="function"==typeof e?new e:e;for(var s in i)s in n||(n[s]=i[s]);delete t.prototyping}),n}},e.extend(t,{inherit:function(n,i){for(var s in i){var o=i[s],a=n[s],r=e.type(o);a&&"function"==r?o!=a&&t.override(n,s,o):n[s]="object"==r?e.merge(a,o):o}return n},override:function(e,n,i){var s=t.prototyping;s&&e[n]!=s[n]&&(s=null);var o=function(){var t=this.parent;this.parent=s?s[n]:e[n];var o=i.apply(this,arguments);return this.parent=t,o};e[n]=o}}),t.prototype.implement=function(){var n=this.prototype;return e.each(Array.prototype.slice.call(arguments||[]),function(e){t.inherit(n,e)}),this},$jit.Class=t,$jit.Trans={$extend:!0,linear:function(e){return e}};var n=$jit.Trans;!function(){var t=function(t,n){return n=e.splat(n),e.extend(t,{easeIn:function(e){return t(e,n)},easeOut:function(e){return 1-t(1-e,n)},easeInOut:function(e){return.5>=e?t(2*e,n)/2:(2-t(2*(1-e),n))/2}})},i={Pow:function(e,t){return Math.pow(e,t[0]||6)},Expo:function(e){return Math.pow(2,8*(e-1))},Circ:function(e){return 1-Math.sin(Math.acos(e))},Sine:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Back:function(e,t){return t=t[0]||1.618,Math.pow(e,2)*((t+1)*e-t)},Bounce:function(e){for(var t,n=0,i=1;1;n+=i,i/=2)if(e>=(7-4*n)/11){t=i*i-Math.pow((11-6*n-11*e)/4,2);break}return t},Elastic:function(e,t){return Math.pow(2,10*--e)*Math.cos(20*e*Math.PI*(t[0]||1)/3)}};e.each(i,function(e,i){n[i]=t(e)}),e.each(["Quad","Cubic","Quart","Quint"],function(e,i){n[e]=t(function(e){return Math.pow(e,[i+2])})})}();var i=new t({initialize:function(e){this.setOptions(e)},setOptions:function(t){var i={duration:2500,fps:40,transition:n.Quart.easeInOut,compute:e.empty,complete:e.empty,link:"ignore"};return this.opt=e.merge(i,t||{}),this},step:function(){var t=e.time(),n=this.opt;if(t<this.time+n.duration){var i=n.transition((t-this.time)/n.duration);n.compute(i)}else this.timer=clearInterval(this.timer),n.compute(1),n.complete()},start:function(){return this.check()?(this.time=0,this.startTimer(),this):this},startTimer:function(){var t=this,n=this.opt.fps;return this.timer?!1:(this.time=e.time()-this.time,this.timer=setInterval(function(){t.step()},Math.round(1e3/n)),!0)},pause:function(){return this.stopTimer(),this},resume:function(){return this.startTimer(),this},stopTimer:function(){return this.timer?(this.time=e.time()-this.time,this.timer=clearInterval(this.timer),!0):!1},check:function(){return this.timer?"cancel"==this.opt.link?(this.stopTimer(),!0):!1:!0}}),s=function(){for(var t=arguments,n=0,i=t.length,o={};i>n;n++){var a=s[t[n]];a.$extend?e.extend(o,a):o[t[n]]=a}return o};s.Canvas={$extend:!0,injectInto:"id",type:"2D",width:!1,height:!1,useCanvas:!1,withLabels:!0,background:!1,Scene:{Lighting:{enable:!1,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[.5,.3,.1]}}}},s.Node={$extend:!1,overridable:!1,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:!1,autoWidth:!1,lineWidth:1,transform:!0,align:"center",angularWidth:1,span:1,CanvasStyles:{}},s.Edge={$extend:!1,overridable:!1,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}},s.Fx={$extend:!0,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:!0},s.Label={$extend:!1,overridable:!1,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"},s.Tips={$extend:!1,enable:!1,type:"auto",offsetX:20,offsetY:20,force:!1,onShow:e.empty,onHide:e.empty},s.NodeStyles={$extend:!1,enable:!1,type:"auto",stylesHover:!1,stylesClick:!1},s.Events={$extend:!1,enable:!1,enableForEdges:!1,type:"auto",onClick:e.empty,onRightClick:e.empty,onMouseMove:e.empty,onMouseEnter:e.empty,onMouseLeave:e.empty,onDragStart:e.empty,onDragMove:e.empty,onDragCancel:e.empty,onDragEnd:e.empty,onTouchStart:e.empty,onTouchMove:e.empty,onTouchEnd:e.empty,onMouseWheel:e.empty},s.Navigation={$extend:!1,enable:!1,type:"auto",panning:!1,zooming:!1},s.Controller={$extend:!0,onBeforeCompute:e.empty,onAfterCompute:e.empty,onCreateLabel:e.empty,onPlaceLabel:e.empty,onComplete:e.empty,onBeforePlotLine:e.empty,onAfterPlotLine:e.empty,onBeforePlotNode:e.empty,onAfterPlotNode:e.empty,request:!1};var o={initialize:function(e,t){this.viz=t,this.canvas=t.canvas,this.config=t.config[e],this.nodeTypes=t.fx.nodeTypes;var n=this.config.type;this.dom="auto"==n?"Native"!=t.config.Label.type:"Native"!=n,this.labelContainer=this.dom&&t.labels.getLabelContainer(),this.isEnabled()&&this.initializePost()},initializePost:e.empty,setAsProperty:e.lambda(!1),isEnabled:function(){return this.config.enable},isLabel:function(t,n,i){t=e.event.get(t,n);var s=this.labelContainer,o=t.target||t.srcElement,a=t.relatedTarget;return i?a&&a==this.viz.canvas.getCtx().canvas&&!!o&&this.isDescendantOf(o,s):this.isDescendantOf(o,s)},isDescendantOf:function(e,t){for(;e&&e.parentNode;){if(e.parentNode==t)return e;e=e.parentNode}return!1}},a={onMouseUp:e.empty,onMouseDown:e.empty,onMouseMove:e.empty,onMouseOver:e.empty,onMouseOut:e.empty,onMouseWheel:e.empty,onTouchStart:e.empty,onTouchMove:e.empty,onTouchEnd:e.empty,onTouchCancel:e.empty},r=new t({initialize:function(e){this.viz=e,this.canvas=e.canvas,this.node=!1,this.edge=!1,this.registeredObjects=[],this.attachEvents()},attachEvents:function(){var t=this.canvas.getElement(),n=this;t.oncontextmenu=e.lambda(!1),e.addEvents(t,{mouseup:function(t,i){var s=e.event.get(t,i);n.handleEvent("MouseUp",t,i,n.makeEventObject(t,i),e.event.isRightClick(s))},mousedown:function(t,i){var s=e.event.get(t,i);n.handleEvent("MouseDown",t,i,n.makeEventObject(t,i),e.event.isRightClick(s))},mousemove:function(e,t){n.handleEvent("MouseMove",e,t,n.makeEventObject(e,t))},mouseover:function(e,t){n.handleEvent("MouseOver",e,t,n.makeEventObject(e,t))},mouseout:function(e,t){n.handleEvent("MouseOut",e,t,n.makeEventObject(e,t))},touchstart:function(e,t){n.handleEvent("TouchStart",e,t,n.makeEventObject(e,t))},touchmove:function(e,t){n.handleEvent("TouchMove",e,t,n.makeEventObject(e,t))},touchend:function(e,t){n.handleEvent("TouchEnd",e,t,n.makeEventObject(e,t))}});var i=function(t,i){var s=e.event.get(t,i),o=e.event.getWheel(s);n.handleEvent("MouseWheel",t,i,o)};document.getBoxObjectFor||null!=window.mozInnerScreenX?t.addEventListener("DOMMouseScroll",i,!1):e.addEvent(t,"mousewheel",i)},register:function(e){this.registeredObjects.push(e)},handleEvent:function(){for(var e=Array.prototype.slice.call(arguments),t=e.shift(),n=0,i=this.registeredObjects,s=i.length;s>n;n++)i[n]["on"+t].apply(i[n],e)},makeEventObject:function(t,n){var i=this,s=this.viz.graph,o=this.viz.fx,a=o.nodeTypes,r=o.edgeTypes;return{pos:!1,node:!1,edge:!1,contains:!1,getNodeCalled:!1,getEdgeCalled:!1,getPos:function(){var s=i.viz.canvas,o=s.getSize(),a=s.getPos(),r=s.translateOffsetX,h=s.translateOffsetY,l=s.scaleOffsetX,c=s.scaleOffsetY,d=e.event.getPos(t,n);return this.pos={x:1*(d.x-a.x-o.width/2-r)/l,y:1*(d.y-a.y-o.height/2-h)/c},this.pos},getNode:function(){if(this.getNodeCalled)return this.node;this.getNodeCalled=!0;for(var e in s.nodes){var t=s.nodes[e],n=t&&a[t.getData("type")],r=n&&n.contains&&n.contains.call(o,t,this.getPos());if(r)return this.contains=r,i.node=this.node=t}return i.node=this.node=!1},getEdge:function(){if(this.getEdgeCalled)return this.edge;this.getEdgeCalled=!0;var e={};for(var t in s.edges){var n=s.edges[t];e[t]=!0;for(var a in n)if(!(a in e)){var h=n[a],l=h&&r[h.getData("type")],c=l&&l.contains&&l.contains.call(o,h,this.getPos());if(c)return this.contains=c,i.edge=this.edge=h}}return i.edge=this.edge=!1},getContains:function(){return this.getNodeCalled?this.contains:(this.getNode(),this.contains)}}}}),h={initializeExtras:function(){var t=new r(this),n=this;e.each(["NodeStyles","Tips","Navigation","Events"],function(e){var i=new h.Classes[e](e,n);i.isEnabled()&&t.register(i),i.setAsProperty()&&(n[e.toLowerCase()]=i)})}};h.Classes={},h.Classes.Events=new t({Implements:[o,a],initializePost:function(){this.fx=this.viz.fx,this.ntypes=this.viz.fx.nodeTypes,this.etypes=this.viz.fx.edgeTypes,this.hovered=!1,this.pressed=!1,this.touched=!1,this.touchMoved=!1,this.moved=!1},setAsProperty:e.lambda(!0),onMouseUp:function(t,n,i,s){var o=e.event.get(t,n);this.moved||(s?this.config.onRightClick(this.hovered,i,o):this.config.onClick(this.pressed,i,o)),this.pressed&&(this.moved?this.config.onDragEnd(this.pressed,i,o):this.config.onDragCancel(this.pressed,i,o),this.pressed=this.moved=!1)},onMouseOut:function(t,n,i){var s,o=e.event.get(t,n);if(this.dom&&(s=this.isLabel(t,n,!0)))return this.config.onMouseLeave(this.viz.graph.getNode(s.id),i,o),this.hovered=!1,void 0;for(var a=o.relatedTarget,r=this.canvas.getElement();a&&a.parentNode;){if(r==a.parentNode)return;a=a.parentNode}this.hovered&&(this.config.onMouseLeave(this.hovered,i,o),this.hovered=!1)},onMouseOver:function(t,n,i){var s,o=e.event.get(t,n);this.dom&&(s=this.isLabel(t,n,!0))&&(this.hovered=this.viz.graph.getNode(s.id),this.config.onMouseEnter(this.hovered,i,o))},onMouseMove:function(t,n,i){var s=e.event.get(t,n);if(this.pressed)return this.moved=!0,this.config.onDragMove(this.pressed,i,s),void 0;if(this.dom)this.config.onMouseMove(this.hovered,i,s);else{if(this.hovered){var o=this.hovered,a=o.nodeFrom?this.etypes[o.getData("type")]:this.ntypes[o.getData("type")],r=a&&a.contains&&a.contains.call(this.fx,o,i.getPos());if(r)return this.config.onMouseMove(o,i,s),void 0;this.config.onMouseLeave(o,i,s),this.hovered=!1}(this.hovered=i.getNode()||this.config.enableForEdges&&i.getEdge())?this.config.onMouseEnter(this.hovered,i,s):this.config.onMouseMove(!1,i,s)}},onMouseWheel:function(t,n,i){this.config.onMouseWheel(i,e.event.get(t,n))},onMouseDown:function(t,n,i){var s,o=e.event.get(t,n);this.dom?(s=this.isLabel(t,n))&&(this.pressed=this.viz.graph.getNode(s.id)):this.pressed=i.getNode()||this.config.enableForEdges&&i.getEdge(),this.pressed&&this.config.onDragStart(this.pressed,i,o)},onTouchStart:function(t,n,i){var s,o=e.event.get(t,n);this.touched=this.dom&&(s=this.isLabel(t,n))?this.viz.graph.getNode(s.id):i.getNode()||this.config.enableForEdges&&i.getEdge(),this.touched&&this.config.onTouchStart(this.touched,i,o)},onTouchMove:function(t,n,i){var s=e.event.get(t,n);this.touched&&(this.touchMoved=!0,this.config.onTouchMove(this.touched,i,s))},onTouchEnd:function(t,n,i){var s=e.event.get(t,n);this.touched&&(this.touchMoved?this.config.onTouchEnd(this.touched,i,s):this.config.onTouchCancel(this.touched,i,s),this.touched=this.touchMoved=!1)}}),h.Classes.Tips=new t({Implements:[o,a],initializePost:function(){if(document.body){var t=e("_tooltip")||document.createElement("div");t.id="_tooltip",t.className="tip",e.extend(t.style,{position:"absolute",display:"none",zIndex:13e3}),document.body.appendChild(t),this.tip=t,this.node=!1}},setAsProperty:e.lambda(!0),onMouseOut:function(t,n){if(e.event.get(t,n),this.dom&&this.isLabel(t,n,!0))return this.hide(!0),void 0;for(var i=t.relatedTarget,s=this.canvas.getElement();i&&i.parentNode;){if(s==i.parentNode)return;i=i.parentNode}this.hide(!1)},onMouseOver:function(e,t){var n;this.dom&&(n=this.isLabel(e,t,!1))&&(this.node=this.viz.graph.getNode(n.id),this.config.onShow(this.tip,this.node,n))},onMouseMove:function(t,n,i){if(this.dom&&this.isLabel(t,n)&&this.setTooltipPosition(e.event.getPos(t,n)),!this.dom){var s=i.getNode();if(!s)return this.hide(!0),void 0;(this.config.force||!this.node||this.node.id!=s.id)&&(this.node=s,this.config.onShow(this.tip,s,i.getContains())),this.setTooltipPosition(e.event.getPos(t,n))}},setTooltipPosition:function(e){var t=this.tip,n=t.style,i=this.config;n.display="";var s={height:document.body.clientHeight,width:document.body.clientWidth},o={width:t.offsetWidth,height:t.offsetHeight},a=i.offsetX,r=i.offsetY;n.top=(e.y+r+o.height>s.height?e.y-o.height-r:e.y+r)+"px",n.left=(e.x+o.width+a>s.width?e.x-o.width-a:e.x+a)+"px"},hide:function(e){this.tip.style.display="none",e&&this.config.onHide()}}),h.Classes.NodeStyles=new t({Implements:[o,a],initializePost:function(){this.fx=this.viz.fx,this.types=this.viz.fx.nodeTypes,this.nStyles=this.config,this.nodeStylesOnHover=this.nStyles.stylesHover,this.nodeStylesOnClick=this.nStyles.stylesClick,this.hoveredNode=!1,this.fx.nodeFxAnimation=new i,this.down=!1,this.move=!1},onMouseOut:function(e,t){if(this.down=this.move=!1,this.hoveredNode){this.dom&&this.isLabel(e,t,!0)&&this.toggleStylesOnHover(this.hoveredNode,!1);for(var n=e.relatedTarget,i=this.canvas.getElement();n&&n.parentNode;){if(i==n.parentNode)return;n=n.parentNode}this.toggleStylesOnHover(this.hoveredNode,!1),this.hoveredNode=!1}},onMouseOver:function(e,t){var n;if(this.dom&&(n=this.isLabel(e,t,!0))){var i=this.viz.graph.getNode(n.id);if(i.selected)return;this.hoveredNode=i,this.toggleStylesOnHover(this.hoveredNode,!0)}},onMouseDown:function(e,t,n,i){if(!i){var s;this.dom&&(s=this.isLabel(e,t))?this.down=this.viz.graph.getNode(s.id):this.dom||(this.down=n.getNode()),this.move=!1}},onMouseUp:function(e,t,n,i){i||(this.move||this.onClick(n.getNode()),this.down=this.move=!1)},getRestoredStyles:function(e,t){var n={},i=this["nodeStylesOn"+t];for(var s in i)n[s]=e.styles["$"+s];return n},toggleStylesOnHover:function(e,t){this.nodeStylesOnHover&&this.toggleStylesOn("Hover",e,t)},toggleStylesOnClick:function(e,t){this.nodeStylesOnClick&&this.toggleStylesOn("Click",e,t)},toggleStylesOn:function(t,i,s){var o=this.viz;if(this.nStyles,s){var a=this;i.styles||(i.styles=e.merge(i.data,{}));for(var r in this["nodeStylesOn"+t]){var h="$"+r;h in i.styles||(i.styles[h]=i.getData(r))}o.fx.nodeFx(e.extend({elements:{id:i.id,properties:a["nodeStylesOn"+t]},transition:n.Quart.easeOut,duration:300,fps:40},this.config))}else{var l=this.getRestoredStyles(i,t);o.fx.nodeFx(e.extend({elements:{id:i.id,properties:l},transition:n.Quart.easeOut,duration:300,fps:40},this.config))}},onClick:function(e){if(e){var t=this.nodeStylesOnClick;t&&(e.selected?(this.toggleStylesOnClick(e,!1),delete e.selected):(this.viz.graph.eachNode(function(e){if(e.selected){for(var n in t)e.setData(n,e.styles["$"+n],"end");delete e.selected}}),this.toggleStylesOnClick(e,!0),e.selected=!0,delete e.hovered,this.hoveredNode=!1))}},onMouseMove:function(e,t,n){if(this.down&&(this.move=!0),!this.dom||!this.isLabel(e,t)){var i=this.nodeStylesOnHover;if(i&&!this.dom){if(this.hoveredNode){var s=this.types[this.hoveredNode.getData("type")],o=s&&s.contains&&s.contains.call(this.fx,this.hoveredNode,n.getPos());if(o)return}var a=n.getNode();if(!this.hoveredNode&&!a)return;if(a.hovered)return;a&&!a.selected?(this.fx.nodeFxAnimation.stopTimer(),this.viz.graph.eachNode(function(e){if(e.hovered&&!e.selected){for(var t in i)e.setData(t,e.styles["$"+t],"end");delete e.hovered}}),a.hovered=!0,this.hoveredNode=a,this.toggleStylesOnHover(a,!0)):this.hoveredNode&&!this.hoveredNode.selected&&(this.fx.nodeFxAnimation.stopTimer(),this.toggleStylesOnHover(this.hoveredNode,!1),delete this.hoveredNode.hovered,this.hoveredNode=!1)}}}}),h.Classes.Navigation=new t({Implements:[o,a],initializePost:function(){this.pos=!1,this.pressed=!1},onMouseWheel:function(t,n,i){if(this.config.zooming){e.event.stop(e.event.get(t,n));var s=this.config.zooming/1e3,o=1+i*s;this.canvas.scale(o,o)}},onMouseDown:function(e,t,n){if(this.config.panning&&("avoid nodes"!=this.config.panning||(this.dom?!this.isLabel(e,t):!n.getNode()))){this.pressed=!0,this.pos=n.getPos();var i=this.canvas,s=i.translateOffsetX,o=i.translateOffsetY,a=i.scaleOffsetX,r=i.scaleOffsetY;this.pos.x*=a,this.pos.x+=s,this.pos.y*=r,this.pos.y+=o}},onMouseMove:function(e,t,n){if(this.config.panning&&this.pressed&&("avoid nodes"!=this.config.panning||(this.dom?!this.isLabel(e,t):!n.getNode()))){var i=this.pos,s=n.getPos(),o=this.canvas,a=o.translateOffsetX,r=o.translateOffsetY,h=o.scaleOffsetX,l=o.scaleOffsetY;s.x*=h,s.y*=l,s.x+=a,s.y+=r;var c=s.x-i.x,d=s.y-i.y;this.pos=s,this.canvas.translate(1*c/h,1*d/l)}},onMouseUp:function(){this.config.panning&&(this.pressed=!1)}});var l;!function(){function n(t,n){var i=document.createElement(t);for(var o in n)"object"==typeof n[o]?e.extend(i[o],n[o]):i[o]=n[o];return"canvas"==t&&!s&&G_vmlCanvasManager&&(i=G_vmlCanvasManager.initElement(document.body.appendChild(i))),i}var i=typeof HTMLCanvasElement,s="object"==i||"function"==i;$jit.Canvas=l=new t({canvases:[],pos:!1,element:!1,labelContainer:!1,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(t,i){this.viz=t,this.opt=this.config=i;var s="string"==e.type(i.injectInto)?i.injectInto:i.injectInto.id,o=i.type,a=s+"-label",r=e(s),h=i.width||r.offsetWidth,c=i.height||r.offsetHeight;this.id=s;var d={injectInto:s,width:h,height:c};this.element=n("div",{id:s+"-canvaswidget",style:{position:"relative",width:h+"px",height:c+"px"}}),this.labelContainer=this.createLabelContainer(i.Label.type,a,d),this.canvases.push(new l.Base[o]({config:e.extend({idSuffix:"-canvas"},d),plot:function(){t.fx.plot()},resize:function(){t.refresh()}}));var u=i.background;if(u){var f=new l.Background[u.type](t,e.extend(u,d));this.canvases.push(new l.Base[o](f))}for(var g=this.canvases.length;g--;)this.element.appendChild(this.canvases[g].canvas),g>0&&this.canvases[g].plot();this.element.appendChild(this.labelContainer),r.appendChild(this.element);var v=null,p=this;e.addEvent(window,"scroll",function(){clearTimeout(v),v=setTimeout(function(){p.getPos(!0)},500)})},getCtx:function(e){return this.canvases[e||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(e){return this.canvases[e||0].getSize()},resize:function(e,t){this.getPos(!0),this.translateOffsetX=this.translateOffsetY=0,this.scaleOffsetX=this.scaleOffsetY=1;for(var n=0,i=this.canvases.length;i>n;n++)this.canvases[n].resize(e,t);var s=this.element.style;s.width=e+"px",s.height=t+"px",this.labelContainer&&(this.labelContainer.style.width=e+"px")},translate:function(e,t,n){this.translateOffsetX+=e*this.scaleOffsetX,this.translateOffsetY+=t*this.scaleOffsetY;for(var i=0,s=this.canvases.length;s>i;i++)this.canvases[i].translate(e,t,n)},scale:function(e,t){var n=this.scaleOffsetX*e,i=this.scaleOffsetY*t,s=this.translateOffsetX*(e-1)/n,o=this.translateOffsetY*(t-1)/i;this.scaleOffsetX=n,this.scaleOffsetY=i;for(var a=0,r=this.canvases.length;r>a;a++)this.canvases[a].scale(e,t,!0);this.translate(s,o,!1)},getPos:function(t){return t||!this.pos?this.pos=e.getPos(this.getElement()):this.pos},clear:function(e){this.canvases[e||0].clear()},path:function(e,t){var n=this.canvases[0].getCtx();n.beginPath(),t(n),n[e](),n.closePath()},createLabelContainer:function(e,t,i){var s="http://www.w3.org/2000/svg";if("HTML"==e||"Native"==e)return n("div",{id:t,style:{overflow:"visible",position:"absolute",top:0,left:0,width:i.width+"px",height:0}});if("SVG"==e){var o=document.createElementNS(s,"svg:svg");o.setAttribute("width",i.width),o.setAttribute("height",i.height);var a=o.style;a.position="absolute",a.left=a.top="0px";var r=document.createElementNS(s,"svg:g");return r.setAttribute("width",i.width),r.setAttribute("height",i.height),r.setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("id",t),o.appendChild(r),o}}}),l.Base={},l.Base["2D"]=new t({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(e){this.viz=e,this.opt=e.config,this.size=!1,this.createCanvas(),this.translateToCenter()},createCanvas:function(){var e=this.opt,t=e.width,i=e.height;this.canvas=n("canvas",{id:e.injectInto+e.idSuffix,width:t,height:i,style:{position:"absolute",top:0,left:0,width:t+"px",height:i+"px"}})},getCtx:function(){return this.ctx?this.ctx:this.ctx=this.canvas.getContext("2d")},getSize:function(){if(this.size)return this.size;var e=this.canvas;return this.size={width:e.width,height:e.height}},translateToCenter:function(e){var t=this.getSize(),n=e?t.width-e.width-2*this.translateOffsetX:t.width;height=e?t.height-e.height-2*this.translateOffsetY:t.height;var i=this.getCtx();e&&i.scale(1/this.scaleOffsetX,1/this.scaleOffsetY),i.translate(n/2,height/2)},resize:function(e,t){var n=this.getSize(),i=this.canvas,o=i.style;this.size=!1,i.width=e,i.height=t,o.width=e+"px",o.height=t+"px",s?this.translateToCenter():this.translateToCenter(n),this.translateOffsetX=this.translateOffsetY=0,this.scaleOffsetX=this.scaleOffsetY=1,this.clear(),this.viz.resize(e,t,this)},translate:function(e,t,n){var i=this.scaleOffsetX,s=this.scaleOffsetY;this.translateOffsetX+=e*i,this.translateOffsetY+=t*s,this.getCtx().translate(e,t),!n&&this.plot()},scale:function(e,t,n){this.scaleOffsetX*=e,this.scaleOffsetY*=t,this.getCtx().scale(e,t),!n&&this.plot()},clear:function(){var e=this.getSize(),t=this.translateOffsetX,n=this.translateOffsetY,i=this.scaleOffsetX,s=this.scaleOffsetY;this.getCtx().clearRect(1*(-e.width/2-t)/i,1*(-e.height/2-n)/s,1*e.width/i,1*e.height/s)},plot:function(){this.clear(),this.viz.plot(this)}}),l.Background={},l.Background.Circles=new t({initialize:function(t,n){this.viz=t,this.config=e.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},n)},resize:function(e,t,n){this.plot(n)},plot:function(e){var t=(e.canvas,e.getCtx()),n=this.config,i=n.CanvasStyles;for(var s in i)t[s]=i[s];for(var o=n.numberOfCircles,a=n.levelDistance,r=1;o>=r;r++)t.beginPath(),t.arc(0,0,a*r,0,2*Math.PI,!1),t.stroke(),t.closePath()}})}();var c=function(e,t){this.x=e||0,this.y=t||0};$jit.Complex=c,c.prototype={getc:function(){return this},getp:function(e){return this.toPolar(e)},set:function(e){e=e.getc(!0),this.x=e.x,this.y=e.y},setc:function(e,t){this.x=e,this.y=t},setp:function(e,t){this.x=Math.cos(e)*t,this.y=Math.sin(e)*t},clone:function(){return new c(this.x,this.y)},toPolar:function(e){var t=this.norm(),n=Math.atan2(this.y,this.x);return 0>n&&(n+=2*Math.PI),e?{theta:n,rho:t}:new Polar(n,t)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(e){return new c(this.x+e.x,this.y+e.y)},prod:function(e){return new c(this.x*e.x-this.y*e.y,this.y*e.x+this.x*e.y)},conjugate:function(){return new c(this.x,-this.y)},scale:function(e){return new c(this.x*e,this.y*e)},equals:function(e){return this.x==e.x&&this.y==e.y},$add:function(e){return this.x+=e.x,this.y+=e.y,this},$prod:function(e){var t=this.x,n=this.y;return this.x=t*e.x-n*e.y,this.y=n*e.x+t*e.y,this},$conjugate:function(){return this.y=-this.y,this},$scale:function(e){return this.x*=e,this.y*=e,this},$div:function(e){var t=this.x,n=this.y,i=e.squaredNorm();return this.x=t*e.x+n*e.y,this.y=n*e.x-t*e.y,this.$scale(1/i)},isZero:function(){var e=1e-4,t=Math.abs;return t(this.x)<e&&t(this.y)<e}};var d=function(e,t){return new c(e,t)};c.KER=d(0,0),$jit.Graph=new t({initialize:function(t,n,i,s){var o={klass:c,Node:{}};this.Node=n,this.Edge=i,this.Label=s,this.opt=e.merge(o,t||{}),this.nodes={},this.edges={};var a=this;this.nodeList={};for(var r in u)a.nodeList[r]=function(e){return function(){var t=Array.prototype.slice.call(arguments);a.eachNode(function(n){n[e].apply(n,t)})}}(r)},getNode:function(e){return this.hasNode(e)?this.nodes[e]:!1},get:function(e){return this.getNode(e)},getByName:function(e){for(var t in this.nodes){var n=this.nodes[t];if(n.name==e)return n}return!1},getAdjacence:function(e,t){return e in this.edges?this.edges[e][t]:!1},addNode:function(t){if(!this.nodes[t.id]){var n=this.edges[t.id]={};this.nodes[t.id]=new f.Node(e.extend({id:t.id,name:t.name,data:e.merge(t.data||{},{}),adjacencies:n},this.opt.Node),this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[t.id]},addAdjacence:function(e,t,n){if(this.hasNode(e.id)||this.addNode(e),this.hasNode(t.id)||this.addNode(t),e=this.nodes[e.id],t=this.nodes[t.id],!e.adjacentTo(t)){var i=this.edges[e.id]=this.edges[e.id]||{},s=this.edges[t.id]=this.edges[t.id]||{};return i[t.id]=s[e.id]=new f.Adjacence(e,t,n,this.Edge,this.Label),i[t.id]}return this.edges[e.id][t.id]},removeNode:function(e){if(this.hasNode(e)){delete this.nodes[e];var t=this.edges[e];for(var n in t)delete this.edges[n][e];delete this.edges[e]}},removeAdjacence:function(e,t){delete this.edges[e][t],delete this.edges[t][e]},hasNode:function(e){return e in this.nodes},empty:function(){this.nodes={},this.edges={}}});var u,f=$jit.Graph;!function(){var t=function(e,t,n,i,s){var o;n=n||"current",e="$"+(e?e+"-":""),"current"==n?o=this.data:"start"==n?o=this.startData:"end"==n&&(o=this.endData);var a=e+t;return i?o[a]:this.Config.overridable?a in o?o[a]:a in this.data?this.data[a]:s[t]||0:s[t]||0},n=function(e,t,n,i){i=i||"current",e="$"+(e?e+"-":"");var s;"current"==i?s=this.data:"start"==i?s=this.startData:"end"==i&&(s=this.endData),s[e+t]=n},i=function(t,n){t="$"+(t?t+"-":"");var i=this;e.each(n,function(e){var n=t+e;delete i.data[n],delete i.endData[n],delete i.startData[n]})};u={getData:function(e,n,i){return t.call(this,"",e,n,i,this.Config)},setData:function(e,t,i){n.call(this,"",e,t,i)},setDataset:function(t,n){t=e.splat(t);for(var i in n)for(var s=0,o=e.splat(n[i]),a=t.length;a>s;s++)this.setData(i,o[s],t[s])},removeData:function(){i.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(e,n,i){return t.call(this,"canvas",e,n,i,this.Config.CanvasStyles)},setCanvasStyle:function(e,t,i){n.call(this,"canvas",e,t,i)},setCanvasStyles:function(t,n){t=e.splat(t);for(var i in n)for(var s=0,o=e.splat(n[i]),a=t.length;a>s;s++)this.setCanvasStyle(i,o[s],t[s])},removeCanvasStyle:function(){i.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(e,n,i){return t.call(this,"label",e,n,i,this.Label)},setLabelData:function(e,t,i){n.call(this,"label",e,t,i)},setLabelDataset:function(t,n){t=e.splat(t);for(var i in n)for(var s=0,o=e.splat(n[i]),a=t.length;a>s;s++)this.setLabelData(i,o[s],t[s])},removeLabelData:function(){i.call(this,"label",Array.prototype.slice.call(arguments))}}}(),f.Node=new t({initialize:function(t,n,i,s,o){var a={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:!1,drawn:!1,exist:!1,angleSpan:{begin:0,end:0},pos:new n,startPos:new n,endPos:new n};e.extend(this,e.extend(a,t)),this.Config=this.Node=i,this.Edge=s,this.Label=o},adjacentTo:function(e){return e.id in this.adjacencies},getAdjacency:function(e){return this.adjacencies[e]},getPos:function(e){return e=e||"current","current"==e?this.pos:"end"==e?this.endPos:"start"==e?this.startPos:void 0},setPos:function(e,t){t=t||"current";var n;"current"==t?n=this.pos:"end"==t?n=this.endPos:"start"==t&&(n=this.startPos),n.set(e)}}),f.Node.implement(u),f.Adjacence=new t({initialize:function(e,t,n,i,s){this.nodeFrom=e,this.nodeTo=t,this.data=n||{},this.startData={},this.endData={},this.Config=this.Edge=i,this.Label=s}}),f.Adjacence.implement(u),f.Util={filter:function(t){if(!t||"string"!=e.type(t))return function(){return!0};var n=t.split(" ");return function(e){for(var t=0;t<n.length;t++)if(e[n[t]])return!1;return!0}},getNode:function(e,t){return e.nodes[t]},eachNode:function(e,t,n){var i=this.filter(n);for(var s in e.nodes)i(e.nodes[s])&&t(e.nodes[s])},each:function(e,t,n){this.eachNode(e,t,n)},eachAdjacency:function(e,t,n){var i=e.adjacencies,s=this.filter(n);for(var o in i){var a=i[o];if(s(a)){if(a.nodeFrom!=e){var r=a.nodeFrom;a.nodeFrom=a.nodeTo,a.nodeTo=r}t(a,o)}}},computeLevels:function(e,t,n,i){n=n||0;var s=this.filter(i);this.eachNode(e,function(e){e._flag=!1,e._depth=-1},i);var o=e.getNode(t);o._depth=n;for(var a=[o];0!=a.length;){var r=a.pop();r._flag=!0,this.eachAdjacency(r,function(e){var t=e.nodeTo;0==t._flag&&s(t)&&(t._depth<0&&(t._depth=r._depth+1+n),a.unshift(t))},i)}},eachBFS:function(e,t,n,i){var s=this.filter(i);this.clean(e);for(var o=[e.getNode(t)];0!=o.length;){var a=o.pop();a._flag=!0,n(a,a._depth),this.eachAdjacency(a,function(e){var t=e.nodeTo;0==t._flag&&s(t)&&(t._flag=!0,o.unshift(t))},i)}},eachLevel:function(e,t,n,i,s){var o=e._depth,a=this.filter(s),r=this;n=n===!1?Number.MAX_VALUE-o:n,function h(e,t,n){var s=e._depth;
s>=t&&n>=s&&a(e)&&i(e,s),n>s&&r.eachAdjacency(e,function(e){var i=e.nodeTo;i._depth>s&&h(i,t,n)})}(e,t+o,n+o)},eachSubgraph:function(e,t,n){this.eachLevel(e,0,!1,t,n)},eachSubnode:function(e,t,n){this.eachLevel(e,1,1,t,n)},anySubnode:function(t,n,i){var s=!1;n=n||e.lambda(!0);var o="string"==e.type(n)?function(e){return e[n]}:n;return this.eachSubnode(t,function(e){o(e)&&(s=!0)},i),s},getSubnodes:function(t,n,i){var s=[];n=n||0;var o,a;return"array"==e.type(n)?(o=n[0],a=n[1]):(o=n,a=Number.MAX_VALUE-t._depth),this.eachLevel(t,o,a,function(e){s.push(e)},i),s},getParents:function(e){var t=[];return this.eachAdjacency(e,function(n){var i=n.nodeTo;i._depth<e._depth&&t.push(i)}),t},isDescendantOf:function(e,t){if(e.id==t)return!0;for(var n=this.getParents(e),i=!1,s=0;!i&&s<n.length;s++)i=i||this.isDescendantOf(n[s],t);return i},clean:function(e){this.eachNode(e,function(e){e._flag=!1})},getClosestNodeToOrigin:function(e,t,n){return this.getClosestNodeToPos(e,Polar.KER,t,n)},getClosestNodeToPos:function(e,t,n,i){var s=null;n=n||"current",t=t&&t.getc(!0)||c.KER;var o=function(e,t){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i};return this.eachNode(e,function(e){s=null==s||o(e.getPos(n).getc(!0),t)<o(s.getPos(n).getc(!0),t)?e:s},i),s}},e.each(["get","getNode","each","eachNode","computeLevels","eachBFS","clean","getClosestNodeToPos","getClosestNodeToOrigin"],function(e){f.prototype[e]=function(){return f.Util[e].apply(f.Util,[this].concat(Array.prototype.slice.call(arguments)))}}),e.each(["eachAdjacency","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"],function(e){f.Node.prototype[e]=function(){return f.Util[e].apply(f.Util,[this].concat(Array.prototype.slice.call(arguments)))}});var g={none:{render:e.empty,contains:e.lambda(!1)},circle:{render:function(e,t,n,i){var s=i.getCtx();s.beginPath(),s.arc(t.x,t.y,n,0,2*Math.PI,!0),s.closePath(),s[e]()},contains:function(e,t,n){var i=e.x-t.x,s=e.y-t.y,o=i*i+s*s;return n*n>=o}},ellipse:{render:function(e,t,n,i,s){var o=s.getCtx(),a=1,r=1,h=1,l=1,c=0;n>i?(c=n/2,r=i/n,l=n/i):(c=i/2,a=n/i,h=i/n),o.save(),o.scale(a,r),o.beginPath(),o.arc(t.x*h,t.y*l,c,0,2*Math.PI,!0),o.closePath(),o[e](),o.restore()},contains:function(e,t,n,i){var s=0,o=1,a=1,r=0,h=0,l=0;return n>i?(s=n/2,a=i/n):(s=i/2,o=n/i),r=(e.x-t.x)*(1/o),h=(e.y-t.y)*(1/a),l=r*r+h*h,s*s>=l}},square:{render:function(e,t,n,i){i.getCtx()[e+"Rect"](t.x-n,t.y-n,2*n,2*n)},contains:function(e,t,n){return Math.abs(t.x-e.x)<=n&&Math.abs(t.y-e.y)<=n}},rectangle:{render:function(e,t,n,i,s){s.getCtx()[e+"Rect"](t.x-n/2,t.y-i/2,n,i)},contains:function(e,t,n,i){return Math.abs(t.x-e.x)<=n/2&&Math.abs(t.y-e.y)<=i/2}},triangle:{render:function(e,t,n,i){var s=i.getCtx(),o=t.x,a=t.y-n,r=o-n,h=t.y+n,l=o+n,c=h;s.beginPath(),s.moveTo(o,a),s.lineTo(r,h),s.lineTo(l,c),s.closePath(),s[e]()},contains:function(e,t,n){return g.circle.contains(e,t,n)}},star:{render:function(e,t,n,i){var s=i.getCtx(),o=Math.PI/5;s.save(),s.translate(t.x,t.y),s.beginPath(),s.moveTo(n,0);for(var a=0;9>a;a++)s.rotate(o),0==a%2?s.lineTo(.200811*(n/.525731),0):s.lineTo(n,0);s.closePath(),s[e](),s.restore()},contains:function(e,t,n){return g.circle.contains(e,t,n)}}},v={line:{render:function(e,t,n){var i=n.getCtx();i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.stroke()},contains:function(e,t,n,i){var s=Math.min,o=Math.max,a=s(e.x,t.x),r=o(e.x,t.x),h=s(e.y,t.y),l=o(e.y,t.y);if(n.x>=a&&n.x<=r&&n.y>=h&&n.y<=l){if(Math.abs(t.x-e.x)<=i)return!0;var c=(t.y-e.y)/(t.x-e.x)*(n.x-e.x)+e.y;return Math.abs(c-n.y)<=i}return!1}},arrow:{render:function(e,t,n,i,s){var o=s.getCtx();if(i){var a=e;e=t,t=a}var r=new c(t.x-e.x,t.y-e.y);r.$scale(n/r.norm());var h=new c(t.x-r.x,t.y-r.y),l=new c(-r.y/2,r.x/2),d=h.add(l),u=h.$add(l.$scale(-1));o.beginPath(),o.moveTo(e.x,e.y),o.lineTo(t.x,t.y),o.stroke(),o.beginPath(),o.moveTo(d.x,d.y),o.lineTo(u.x,u.y),o.lineTo(t.x,t.y),o.closePath(),o.fill()},contains:function(e,t,n,i){return v.line.contains(e,t,n,i)}}};f.Plot={initialize:function(e,t){this.viz=e,this.config=e.config,this.node=e.config.Node,this.edge=e.config.Edge,this.animation=new i,this.nodeTypes=new t.Plot.NodeTypes,this.edgeTypes=new t.Plot.EdgeTypes,this.labels=e.labels},nodeHelper:g,edgeHelper:v,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(e,t,n){return e+(t-e)*n},moebius:function(e,t,n,i){var s=i.scale(-n);if(s.norm()<1){var o=s.x,a=s.y,r=e.startPos.getc().moebiusTransformation(s);e.pos.setc(r.x,r.y),s.x=o,s.y=a}},linear:function(e,t,n){var i=e.startPos.getc(!0),s=e.endPos.getc(!0);e.pos.setc(this.compute(i.x,s.x,n),this.compute(i.y,s.y,n))},polar:function(e,t,n){var i=e.startPos.getp(!0),s=e.endPos.getp(),o=s.interpolate(i,n);e.pos.setp(o.theta,o.rho)},number:function(e,t,n,i,s){var o=e[i](t,"start"),a=e[i](t,"end");e[s](t,this.compute(o,a,n))},color:function(t,n,i,s,o){var a=e.hexToRgb(t[s](n,"start")),r=e.hexToRgb(t[s](n,"end")),h=this.compute,l=e.rgbToHex([parseInt(h(a[0],r[0],i)),parseInt(h(a[1],r[1],i)),parseInt(h(a[2],r[2],i))]);t[o](n,l)},"array-number":function(e,t,n,i,s){for(var o=e[i](t,"start"),a=e[i](t,"end"),r=[],h=0,l=o.length;l>h;h++){var c=o[h],d=a[h];if(c.length){for(var u=0,f=c.length,g=[];f>u;u++)g.push(this.compute(c[u],d[u],n));r.push(g)}else r.push(this.compute(c,d,n))}e[s](t,r)},node:function(e,t,n,i,s,o){if(i=this[i],t)for(var a=t.length,r=0;a>r;r++){var h=t[r];this[i[h]](e,h,n,s,o)}else for(var h in i)this[i[h]](e,h,n,s,o)},edge:function(e,t,n,i,s,o){var a=e.adjacencies;for(var r in a)this.node(a[r],t,n,i,s,o)},"node-property":function(e,t,n){this.node(e,t,n,"map","getData","setData")},"edge-property":function(e,t,n){this.edge(e,t,n,"map","getData","setData")},"label-property":function(e,t,n){this.node(e,t,n,"label","getLabelData","setLabelData")},"node-style":function(e,t,n){this.node(e,t,n,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(e,t,n){this.edge(e,t,n,"canvas","getCanvasStyle","setCanvasStyle")}},prepare:function(t){var n=this.viz.graph,i={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}},s={};if("array"==e.type(t))for(var o=0,a=t.length;a>o;o++){var r=t[o].split(":");s[r.shift()]=r}else for(var h in t)"position"==h?s[t.position]=[]:s[h]=e.splat(t[h]);return n.eachNode(function(t){t.startPos.set(t.pos),e.each(["node-property","node-style"],function(e){if(e in s)for(var n=s[e],o=0,a=n.length;a>o;o++)t[i[e].setter](n[o],t[i[e].getter](n[o]),"start")}),e.each(["edge-property","edge-style"],function(e){if(e in s){var n=s[e];t.eachAdjacency(function(t){for(var s=0,o=n.length;o>s;s++)t[i[e].setter](n[s],t[i[e].getter](n[s]),"start")})}})}),s},animate:function(t,n){t=e.merge(this.viz.config,t||{});var i=this,s=this.viz,o=s.graph,a=this.Interpolator,r="nodefx"===t.type?this.nodeFxAnimation:this.animation,h=this.prepare(t.modes);t.hideLabels&&this.labels.hideLabels(!0),r.setOptions(e.extend(t,{$animating:!1,compute:function(e){o.eachNode(function(t){for(var i in h)a[i](t,h[i],e,n)}),i.plot(t,this.$animating,e),this.$animating=!0},complete:function(){t.hideLabels&&i.labels.hideLabels(!1),i.plot(t),t.onComplete()}})).start()},plot:function(e,t){var n=this.viz,i=n.graph,s=n.canvas,o=n.root,a=this,e=(s.getCtx(),Math.min,e||this.viz.controller);e.clearCanvas&&s.clear();var r=i.getNode(o);if(r){var h=!!r.visited;i.eachNode(function(n){var i=n.getData("alpha");n.eachAdjacency(function(i){var o=i.nodeTo;!!o.visited===h&&n.drawn&&o.drawn&&(!t&&e.onBeforePlotLine(i),a.plotLine(i,s,t),!t&&e.onAfterPlotLine(i))}),n.drawn&&(!t&&e.onBeforePlotNode(n),a.plotNode(n,s,t),!t&&e.onAfterPlotNode(n)),!a.labelsHidden&&e.withLabels&&(n.drawn&&i>=.95?a.labels.plotLabel(s,n,e):a.labels.hideLabel(n,!1)),n.visited=!h})}},plotTree:function(e,t,n){var i=this,s=this.viz,o=s.canvas;this.config,o.getCtx();var a=e.getData("alpha");e.eachSubnode(function(s){if(t.plotSubtree(e,s)&&s.exist&&s.drawn){var a=e.getAdjacency(s.id);!n&&t.onBeforePlotLine(a),i.plotLine(a,o,n),!n&&t.onAfterPlotLine(a),i.plotTree(s,t,n)}}),e.drawn?(!n&&t.onBeforePlotNode(e),this.plotNode(e,o,n),!n&&t.onAfterPlotNode(e),!t.hideLabels&&t.withLabels&&a>=.95?this.labels.plotLabel(o,e,t):this.labels.hideLabel(e,!1)):this.labels.hideLabel(e,!0)},plotNode:function(e,t,n){var i=e.getData("type"),s=this.node.CanvasStyles;if("none"!=i){var o=e.getData("lineWidth"),a=e.getData("color"),r=e.getData("alpha"),h=t.getCtx();h.save(),h.lineWidth=o,h.fillStyle=h.strokeStyle=a,h.globalAlpha=r;for(var l in s)h[l]=e.getCanvasStyle(l);this.nodeTypes[i].render.call(this,e,t,n),h.restore()}},plotLine:function(e,t,n){var i=e.getData("type"),s=this.edge.CanvasStyles;if("none"!=i){var o=e.getData("lineWidth"),a=e.getData("color"),r=t.getCtx(),h=e.nodeFrom,l=e.nodeTo;r.save(),r.lineWidth=o,r.fillStyle=r.strokeStyle=a,r.globalAlpha=Math.min(h.getData("alpha"),l.getData("alpha"),e.getData("alpha"));for(var c in s)r[c]=e.getCanvasStyle(c);this.edgeTypes[i].render.call(this,e,t,n),r.restore()}}},f.Label={},f.Label.Native=new t({initialize:function(e){this.viz=e},plotLabel:function(e,t,n){var i=e.getCtx();t.pos.getc(!0),i.font=t.getLabelData("style")+" "+t.getLabelData("size")+"px "+t.getLabelData("family"),i.textAlign=t.getLabelData("textAlign"),i.fillStyle=i.strokeStyle=t.getLabelData("color"),i.textBaseline=t.getLabelData("textBaseline"),this.renderLabel(e,t,n)},hideLabel:e.empty,hideLabels:e.empty}),f.Label.DOM=new t({labelsHidden:!1,labelContainer:!1,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(e){return e in this.labels&&null!=this.labels[e]?this.labels[e]:this.labels[e]=document.getElementById(e)},hideLabels:function(e){var t=this.getLabelContainer();t.style.display=e?"none":"",this.labelsHidden=e},clearLabels:function(e){for(var t in this.labels)(e||!this.viz.graph.hasNode(t))&&(this.disposeLabel(t),delete this.labels[t])},disposeLabel:function(e){var t=this.getLabel(e);t&&t.parentNode&&t.parentNode.removeChild(t)},hideLabel:function(t,n){t=e.splat(t);var i=n?"":"none",s=this;e.each(t,function(e){var t=s.getLabel(e.id);t&&(t.style.display=i)})},fitsInCanvas:function(e,t){var n=t.getSize();return e.x>=n.width||e.x<0||e.y>=n.height||e.y<0?!1:!0}}),f.Label.HTML=new t({Implements:f.Label.DOM,plotLabel:function(e,t,n){var i=t.id,s=this.getLabel(i);if(!s&&!(s=document.getElementById(i))){s=document.createElement("div");var o=this.getLabelContainer();s.id=i,s.className="node",s.style.position="absolute",n.onCreateLabel(s,t),o.appendChild(s),this.labels[t.id]=s}this.placeLabel(s,t,n)}});var p={construct:function(t){var n="array"==e.type(t),i=new f(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);return n?function(t,n){for(var i=function(e){for(var i=0,s=n.length;s>i;i++)if(n[i].id==e)return n[i];var o={id:e,name:e};return t.addNode(o)},s=0,o=n.length;o>s;s++){t.addNode(n[s]);var a=n[s].adjacencies;if(a)for(var r=0,h=a.length;h>r;r++){var l=a[r],c={};"string"!=typeof a[r]&&(c=e.merge(l.data,{}),l=l.nodeTo),t.addAdjacence(n[s],i(l),c)}}}(i,t):function(e,t){if(e.addNode(t),t.children)for(var n=0,i=t.children;n<i.length;n++)e.addAdjacence(t,i[n]),arguments.callee(e,i[n])}(i,t),i},loadJSON:function(t,n){this.json=t,this.labels&&this.labels.clearLabels&&this.labels.clearLabels(!0),this.graph=this.construct(t),this.root="array"!=e.type(t)?t.id:t[n?n:0].id},toJSON:function(e){if(e=e||"tree","tree"==e){var t={},n=this.graph.getNode(this.root),t=function s(e){var t={};t.id=e.id,t.name=e.name,t.data=e.data;var n=[];return e.eachSubnode(function(e){n.push(s(e))}),t.children=n,t}(n);return t}var t=[],i=!!this.graph.getNode(this.root).visited;return this.graph.eachNode(function(e){var n={};n.id=e.id,n.name=e.name,n.data=e.data;var s=[];e.eachAdjacency(function(e){var t=e.nodeTo;if(!!t.visited===i){var n={};n.nodeTo=t.id,n.data=e.data,s.push(n)}}),n.adjacencies=s,t.push(n),e.visited=!i}),t}},m=$jit.Layouts={};m.TM={},m.TM.Area={compute:function(e){e=e||"current";var t=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(t);var n=this.config,i=this.canvas.getSize(),s=i.width,o=i.height,a=n.offset,r=s-a,h=o-a;this.graph.computeLevels(this.root,0,"ignore"),t.getPos(e).setc(-s/2,-o/2),t.setData("width",s,e),t.setData("height",o,e);var l={top:-o/2+n.titleHeight,left:-s/2,width:r,height:h-n.titleHeight};this.computePositions(t,l,e),this.controller.onAfterCompute(t)},computeDim:function(e,t,n,i,s,o){if(1==e.length+t.length){var a=1==e.length?e:t;return this.layoutLast(a,n,i,o),void 0}if(e.length>=2&&0==t.length&&(t=[e.shift()]),0==e.length)return t.length>0&&this.layoutRow(t,n,i,o),void 0;var r=e[0];if(s(t,n)>=s([r].concat(t),n))this.computeDim(e.slice(1),t.concat([r]),n,i,s,o);else{var h=this.layoutRow(t,n,i,o);this.computeDim(e,[],h.dim,h,s,o)}},worstAspectRatio:function(e,t){if(!e||0==e.length)return Number.MAX_VALUE;for(var n=0,i=0,s=Number.MAX_VALUE,o=0,a=e.length;a>o;o++){var r=e[o]._area;n+=r,s=r>s?s:r,i=i>r?i:r}var h=t*t,l=n*n;return Math.max(h*i/l,l/(h*s))},avgAspectRatio:function(e,t){if(!e||0==e.length)return Number.MAX_VALUE;for(var n=0,i=0,s=e.length;s>i;i++){var o=e[i]._area,a=o/t;n+=t>a?t/a:a/t}return n/s},layoutLast:function(e,t,n,i){var s=e[0];s.getPos(i).setc(n.left,n.top),s.setData("width",n.width,i),s.setData("height",n.height,i)}},m.TM.Squarified=new t({Implements:m.TM.Area,computePositions:function(e,t,n){var i=this.config,s=Math.max;this.layout.orientation=t.width>=t.height?"h":"v";var o=e.getSubnodes([1,1],"ignore");if(o.length>0){this.processChildrenLayout(e,o,t,n);for(var a=0,r=o.length;r>a;a++){var h=o[a],l=i.offset,c=s(h.getData("height",n)-l-i.titleHeight,0),d=s(h.getData("width",n)-l,0),u=h.getPos(n);t={width:d,height:c,top:u.y+i.titleHeight,left:u.x},this.computePositions(h,t,n)}}},processChildrenLayout:function(e,t,n,i){var s,o=n.width*n.height,a=t.length,r=0,h=[];for(s=0;a>s;s++)h[s]=parseFloat(t[s].getData("area",i)),r+=h[s];for(s=0;a>s;s++)t[s]._area=o*h[s]/r;var l=this.layout.horizontal()?n.height:n.width;t.sort(function(e,t){var n=t._area-e._area;return n?n:t.id==e.id?0:t.id<e.id?1:-1});var c=[t[0]],d=t.slice(1);this.squarify(d,c,l,n,i)},squarify:function(e,t,n,i,s){this.computeDim(e,t,n,i,this.worstAspectRatio,s)},layoutRow:function(e,t,n,i){return this.layout.horizontal()?this.layoutV(e,t,n,i):this.layoutH(e,t,n,i)},layoutV:function(t,n,i,s){var o=0,a=function(e){return e};e.each(t,function(e){o+=e._area});for(var r=a(o/n),h=0,l=0,c=t.length;c>l;l++){var d=a(t[l]._area/r),u=t[l];u.getPos(s).setc(i.left,i.top+h),u.setData("width",r,s),u.setData("height",d,s),h+=d}var f={height:i.height,width:i.width-r,top:i.top,left:i.left+r};return f.dim=Math.min(f.width,f.height),f.dim!=f.height&&this.layout.change(),f},layoutH:function(t,n,i,s){var o=0;e.each(t,function(e){o+=e._area});for(var a=o/n,r=i.top,h=0,l=0,c=t.length;c>l;l++){var d=t[l],n=d._area/a;d.getPos(s).setc(i.left+h,r),d.setData("width",n,s),d.setData("height",a,s),h+=n}var u={height:i.height-a,width:i.width,top:i.top+a,left:i.left};return u.dim=Math.min(u.width,u.height),u.dim!=u.width&&this.layout.change(),u}}),$jit.TM={};var y=$jit.TM;$jit.TM.$extend=!0,y.Base={layout:{orientation:"h",vertical:function(){return"v"==this.orientation},horizontal:function(){return"h"==this.orientation},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(t){var n={orientation:"h",titleHeight:13,offset:2,levelsToShow:0,constrained:!1,animate:!1,Node:{type:"rectangle",overridable:!0,width:3,height:3,color:"#444"},Label:{textAlign:"center",textBaseline:"top"},Edge:{type:"none"},duration:700,fps:45};this.controller=this.config=e.merge(s("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),n,t),this.layout.orientation=this.config.orientation;var i=this.config;i.useCanvas?(this.canvas=i.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(i.background&&(i.background=e.merge({type:"Circles"},i.background)),this.canvas=new l(this,i),this.config.labelContainer=("string"==typeof i.injectInto?i.injectInto:i.injectInto.id)+"-label"),this.graphOptions={klass:c,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new f(this.graphOptions,this.config.Node,this.config.Edge),this.labels=new y.Label[i.Label.type](this),this.fx=new y.Plot(this),this.op=new y.Op(this),this.group=new y.Group(this),this.geom=new y.Geom(this),this.clickedNode=null,this.busy=!1,this.initializeExtras()},refresh:function(){if(!this.busy){this.busy=!0;var t=this;if(this.config.animate)this.compute("end"),this.config.levelsToShow>0&&this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root)),this.fx.animate(e.merge(this.config,{modes:["linear","node-property:width:height"],onComplete:function(){t.busy=!1}}));else{var n=this.config.Label.type;if("Native"!=n){var t=this;this.graph.eachNode(function(e){t.labels.hideLabel(e,!1)})}this.busy=!1,this.compute(),this.config.levelsToShow>0&&this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root)),this.plot()}}},plot:function(){this.fx.plot()},leaf:function(e){return 0==e.getSubnodes([1,1],"ignore").length},enter:function(e){if(!this.busy){this.busy=!0;var t=this,n=this.config,i=this.graph,s=e,o=this.clickedNode,a={onComplete:function(){n.levelsToShow>0&&t.geom.setRightLevelToShow(e),(n.levelsToShow>0||n.request)&&t.compute(),n.animate?(i.nodeList.setData("alpha",0,"end"),e.eachSubgraph(function(e){e.setData("alpha",1,"end")},"ignore"),t.fx.animate({duration:100,modes:["node-property:alpha"],onComplete:function(){t.clickedNode=s,t.compute("end"),t.clickedNode=o,t.fx.animate({modes:["linear","node-property:width:height"],duration:200,onComplete:function(){t.busy=!1,t.clickedNode=s}})}})):(t.busy=!1,t.clickedNode=e,t.refresh())}};n.request?this.requestNodes(s,a):a.onComplete()}},out:function(){if(!this.busy){this.busy=!0,this.events.hoveredNode=!1;var e=this,t=this.config,n=this.graph,i=n.getNode(this.clickedNode&&this.clickedNode.id||this.root).getParents(),s=i[0],o=s,a=this.clickedNode;if(!s)return this.busy=!1,void 0;callback={onComplete:function(){e.clickedNode=s,t.request?e.requestNodes(s,{onComplete:function(){e.compute(),e.plot(),e.busy=!1}}):(e.compute(),e.plot(),e.busy=!1)}},t.levelsToShow>0&&this.geom.setRightLevelToShow(s),t.animate?(this.clickedNode=o,this.compute("end"),this.clickedNode=a,this.fx.animate({modes:["linear","node-property:width:height"],duration:200,onComplete:function(){e.clickedNode=o,n.eachNode(function(e){e.setDataset(["current","end"],{alpha:[0,1]})},"ignore"),a.eachSubgraph(function(e){e.setData("alpha",1)},"ignore"),e.fx.animate({duration:100,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}})):callback.onComplete()}},requestNodes:function(t,n){var i=e.merge(this.controller,n),s=this.config.levelsToShow;if(i.request){var o=[],a=t._depth;t.eachLevel(0,s,function(e){var t=s-(e._depth-a);e.drawn&&!e.anySubnode()&&t>0&&(o.push(e),e._level=t)}),this.group.requestNodes(o,i)}else i.onComplete()},reposition:function(){this.compute("end")}},y.Op=new t({Implements:f.Op,initialize:function(e){this.viz=e}}),y.Geom=new t({Implements:f.Geom,getRightLevelToShow:function(){return this.viz.config.levelsToShow},setRightLevelToShow:function(e){var t=this.getRightLevelToShow(),n=this.viz.labels;e.eachLevel(0,t+1,function(i){var s=i._depth-e._depth;s>t?(i.drawn=!1,i.exist=!1,i.ignore=!0,n.hideLabel(i,!1)):(i.drawn=!0,i.exist=!0,delete i.ignore)}),e.drawn=!0,delete e.ignore}}),y.Group=new t({initialize:function(e){this.viz=e,this.canvas=e.canvas,this.config=e.config},requestNodes:function(e,t){var n=0,i=e.length,s={},o=function(){t.onComplete()},a=this.viz;0==i&&o();for(var r=0;i>r;r++)s[e[r].id]=e[r],t.request(e[r].id,e[r]._level,{onComplete:function(e,t){t&&t.children&&(t.id=e,a.op.sum(t,{type:"nothing"})),++n==i&&(a.graph.computeLevels(a.root,0),o())}})}}),y.Plot=new t({Implements:f.Plot,initialize:function(e){this.viz=e,this.config=e.config,this.node=this.config.Node,this.edge=this.config.Edge,this.animation=new i,this.nodeTypes=new y.Plot.NodeTypes,this.edgeTypes=new y.Plot.EdgeTypes,this.labels=e.labels},plot:function(t,n){var i=this.viz,s=i.graph;i.canvas.clear(),this.plotTree(s.getNode(i.clickedNode&&i.clickedNode.id||i.root),e.merge(i.config,t||{},{withLabels:!0,hideLabels:!1,plotSubtree:function(e){return e.anySubnode("exist")}}),n)}}),y.Label={},y.Label.HTML=new t({Implements:f.Label.HTML,initialize:function(e){this.viz=e,this.leaf=e.leaf,this.config=e.config},placeLabel:function(e,t,n){var i=t.pos.getc(!0),s=this.viz.canvas,o=s.translateOffsetX,a=s.translateOffsetY,r=s.scaleOffsetX,h=s.scaleOffsetY,l=s.getSize(),c={x:Math.round(i.x*r+o+l.width/2),y:Math.round(i.y*h+a+l.height/2)},d=e.style;d.left=c.x+"px",d.top=c.y+"px",d.width=t.getData("width")*r+"px",d.height=t.getData("height")*h+"px",d.zIndex=100*t._depth,d.display="",this.leaf(t)||this.config.titleHeight||(e.style.display="none"),n.onPlaceLabel(e,t)}}),y.Plot.NodeTypes=new t({rectangle:{render:function(t,n){var i=this.viz.leaf(t),s=this.config,o=s.offset,a=s.titleHeight,r=t.pos.getc(!0),h=t.getData("width"),l=t.getData("height"),c=t.getData("border"),d=n.getCtx(),u=r.x+o/2,f=r.y+o/2;if(!(o>=h||o>=l))if(i){if(s.cushion){var g=d.createRadialGradient(u+(h-o)/2,f+(l-o)/2,1,u+(h-o)/2,f+(l-o)/2,l>h?l:h),v=t.getData("color"),p=e.rgbToHex(e.map(e.hexToRgb(v),function(e){return.2*e>>0}));g.addColorStop(0,v),g.addColorStop(1,p),d.fillStyle=g}d.fillRect(u,f,h-o,l-o),c&&(d.save(),d.strokeStyle=c,d.strokeRect(u,f,h-o,l-o),d.restore())}else a>0&&(d.fillRect(r.x+o/2,r.y+o/2,h-o,a-o),c&&(d.save(),d.strokeStyle=c,d.strokeRect(r.x+o/2,r.y+o/2,h-o,l-o),d.restore()))}}}),y.Plot.EdgeTypes=new t({none:e.empty}),y.Squarified=new t({Implements:[p,h,y.Base,m.TM.Squarified]})}();